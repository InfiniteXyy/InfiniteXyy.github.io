<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> realm-learn · InfiniteX</title><meta name="description" content="realm-learn - Yiyang Xu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://infinitexyy.github.io/blog/atom.xml" title="InfiniteX"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/blog/about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="https://github.com/InfiniteXyy" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">realm-learn</h1><div class="post-info">2019年4月2日</div><div class="post-content"><p>这是自己以前总结的一篇关于Realm使用的文章<br><a id="more"></a></p>
<h1 id="Realm-Learn"><a href="#Realm-Learn" class="headerlink" title="Realm Learn"></a>Realm Learn</h1><p>base on realm 2.13.0</p>
<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><p>in <code>javascript</code>, <em>Table schema</em> in <strong>Realm</strong> is an <strong>object</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//schema of studnet</span></span><br><span class="line"><span class="keyword">const</span> student = &#123;</span><br><span class="line">    name: <span class="string">"Student"</span> <span class="comment">// Required: Table name,</span></span><br><span class="line">    primaryKey: <span class="string">"id"</span>, <span class="comment">// Optional</span></span><br><span class="line">    properties: &#123;</span><br><span class="line">    	id: &#123;<span class="attr">type</span>: <span class="string">"int"</span>&#125;</span><br><span class="line">    	student_name: &#123; <span class="attr">type</span>: <span class="string">"string"</span> &#125;</span><br><span class="line">    	...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Property-object"><a href="#Property-object" class="headerlink" title="Property object:"></a>Property object:</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">name = &#123;</span><br><span class="line">    <span class="comment">// int, bool, string, float, double, date, data,</span></span><br><span class="line">    type: <span class="string">"string"</span>, <span class="comment">// Required</span></span><br><span class="line">    optional: <span class="literal">false</span>, <span class="comment">// Optional, if true, property can be null/undefined,</span></span><br><span class="line">    <span class="keyword">default</span>: <span class="string">"noname"</span>, <span class="comment">// Optional</span></span><br><span class="line">    index: <span class="literal">true</span> <span class="comment">// Optional, only support int, string, bool, date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>List property can be defined as <code>int[]</code> or <code>string?[]</code></p>
<p>notice that list property can’t assgined null.</p>
<h6 id="syntactic-sugar"><a href="#syntactic-sugar" class="headerlink" title="syntactic sugar:"></a>syntactic sugar:</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">properties = &#123;</span><br><span class="line">    name: <span class="string">"string"</span>,</span><br><span class="line">    scores: <span class="string">"int[]"</span>,</span><br><span class="line">    avatar: <span class="string">"data?"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="relation"><a href="#relation" class="headerlink" title="relation"></a>relation</h2><h4 id="To-one"><a href="#To-one" class="headerlink" title="To-one"></a>To-one</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">properties = &#123;</span><br><span class="line">    owenr: <span class="string">"Person"</span> <span class="comment">// just use another table name as the type</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>make sure all the tables included are opened by Realm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// its quite easy to access realted object</span></span><br><span class="line">dog.owner.age += <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h4 id="To-many"><a href="#To-many" class="headerlink" title="To-many"></a>To-many</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">properties = &#123;</span><br><span class="line">    tasks: <span class="string">"Homework[]"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add new task</span></span><br><span class="line"><span class="keyword">let</span> anotherTask = &#123;<span class="attr">content</span>: <span class="string">""</span>, <span class="attr">createTime</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()&#125;</span><br><span class="line">course.tasks.push(anotherTask)</span><br><span class="line"><span class="comment">// get task</span></span><br><span class="line"><span class="keyword">let</span> taskOne = course.tasks[<span class="number">0</span>].model</span><br></pre></td></tr></table></figure>
<h4 id="Inverse"><a href="#Inverse" class="headerlink" title="Inverse"></a>Inverse</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.properties.dogs = "Dog[]"</span></span><br><span class="line">owners: &#123;<span class="attr">type</span>: <span class="string">'linkingObjects'</span>, <span class="attr">objectType</span>: <span class="string">'Person'</span>, <span class="attr">property</span>: <span class="string">'dogs'</span>&#125;</span><br><span class="line"><span class="comment">// Homework.properties.course = "Course"</span></span><br><span class="line">homeworkList: &#123;<span class="attr">type</span>: <span class="string">'linkingObjects'</span>, <span class="attr">objectType</span>: <span class="string">'Homework'</span>, <span class="attr">property</span>: <span class="string">'course'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>First it’s a <strong>many-many</strong> relation: </p>
<blockquote>
<p><em>many dogs to many owners</em></p>
</blockquote>
<p>access by <code>dog.owners</code></p>
<p>Second it’s a <strong>one-many </strong>relation</p>
<blockquote>
<p><em>many homework to one course</em></p>
</blockquote>
<p>access by <code>course.homeworkList</code></p>
<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p><strong>In order to chang data in the database, you have to use <code>write()</code> method first.</strong></p>
<p><strong>Use minimum numbers of  <code>write</code>  block</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dogSchema = &#123;</span><br><span class="line">    name: <span class="string">"Dog"</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">        age: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// try catch is not required</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    realm.write(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    	... <span class="comment">// CUD</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Error on write()"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">realm.write(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> myDog = realm.create(<span class="string">'Dog'</span>, &#123;<span class="attr">age</span>: <span class="number">4</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="read"><a href="#read" class="headerlink" title="read"></a>read</h4><h6 id="query-method"><a href="#query-method" class="headerlink" title="query method"></a>query method</h6><ul>
<li>filtered<ul>
<li>comparison operators  ( &gt;, &lt;, &lt;=, ==, !=. )</li>
<li>String (CONTAINS, BEGINWITH, ENDWITH, LIKE)</li>
<li>AND, OR</li>
<li>aggregate expression(.@size, .@min, .@max, .@avg)</li>
</ul>
</li>
<li>sorted<ul>
<li>name DESC, age ASC (DESC is <code>true</code> as the second param)</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> oldDogs = realm.objects(<span class="string">'Dog'</span>).filtered(<span class="string">'age &gt; 100'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> oldDogs = realm.objects(<span class="string">'Dog'</span>).sorted([[<span class="string">'age'</span>, <span class="literal">true</span>], [<span class="string">'name'</span>, <span class="literal">false</span>]])</span><br></pre></td></tr></table></figure>
<h6 id="Tips"><a href="#Tips" class="headerlink" title="Tips:"></a>Tips:</h6><ul>
<li>results are auto-updated</li>
</ul>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">realm.write(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    myDog.age += <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">realm.write(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    realm.delete(myDog)</span><br><span class="line">    realm.deleta(oldDogs) <span class="comment">// can delect object list</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="open-close"><a href="#open-close" class="headerlink" title="open/close"></a>open/close</h2><h6 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Realm.open(&#123;Configuration&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">realm</span> =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="Synchromnously-open"><a href="#Synchromnously-open" class="headerlink" title="Synchromnously open"></a>Synchromnously open</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> realm = <span class="keyword">new</span> Realm(&#123;options&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration:"></a>Configuration:</h4><ul>
<li><p><code>schema</code> : <strong>Required</strong></p>
</li>
<li><p><code>schemaVersion</code> : <strong>Required</strong> if realm did exist</p>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// to get current version</span></span><br><span class="line"><span class="keyword">const</span> v = Realm.schemaVersion(Realm.defaultPath);</span><br><span class="line"><span class="keyword">let</span> nextVersion = v + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>migaration</code> : update database schema, keep original data</p>
</li>
<li><p><code>deleteRealmIfMigrationNeeded</code> : for development.</p>
</li>
<li><p><code>path</code> : will use default path if not specified</p>
</li>
<li><p><code>sync</code> : open a synchronized Realm on the serverside</p>
<p>…</p>
</li>
</ul>
<h2 id="Listeners"><a href="#Listeners" class="headerlink" title="Listeners"></a>Listeners</h2><blockquote>
<p>Realm instances send out notifications to other instances <strong>every time a write transaction is committed</strong>.</p>
</blockquote>
<p>All the <strong>List, Results, Realm</strong> provides <code>addListenr</code> Method</p>
<h6 id="Realm-Notifications-realm-addListener"><a href="#Realm-Notifications-realm-addListener" class="headerlink" title="Realm Notifications (realm.addListener)"></a>Realm Notifications (realm.addListener)</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Observe Realm Notifications</span></span><br><span class="line">realm.addListener(<span class="string">'change'</span>, updateUI);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..later remove the listener</span></span><br><span class="line">realm.removeListener(<span class="string">'change'</span>, updateUI);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..or unregister all listeners</span></span><br><span class="line">realm.removeAllListeners();</span><br></pre></td></tr></table></figure>
<h6 id="Collection-Notifications"><a href="#Collection-Notifications" class="headerlink" title="Collection Notifications"></a>Collection Notifications</h6></div></article></div></main><footer><div class="paginator"><a href="/blog/2019/04/06/webpack/" class="prev">上一篇</a><a href="/blog/2019/03/30/leetcode-graph/" class="next">下一篇</a></div><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
    clientID: 'b6e1047fa622a6e8f554',
    clientSecret: '37f6dc0c4c6ed7892e12f214b2ea319edb968f9e',
    repo: 'InfiniteXyy.github.io',
    owner: 'InfiniteXyy',
    admin: 'InfiniteXyy',
    id: window.location.pathname,
    distractionFreeMode: false  // Facebook-like distraction free mode
})
gitalk.render('gitalk-container')</script><div class="copyright"><p>© 2019 <a href="https://infinitexyy.github.io/blog">Yiyang Xu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>